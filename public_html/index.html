<!--
<!DOCTYPE html>
<html><head>
    <meta charset="utf-8" />
    <title>topsecret game</title>
    <link rel="stylesheet" type="text/css" href="css/main.css" />
</head><body>
<div id="page"></div>
<script data-main="js/main" src="js/lib/require.js"></script>
<script src="js/lib/snowfall.js"></script>
</body></html>
-->
<!DOCTYPE HTML>
<html>
<head>
    <style>
        body {
            margin: 0px;
            padding: 0px;
        }
    </style>
</head>
<body>
<canvas id="myCanvas"></canvas>
<script>
    window.requestAnimFrame = (function(callback) {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
                function(callback) {
                    window.setTimeout(callback, 1000 / 60);
                };
    })();

    function drawArc(myArc, context) {
        context.beginPath();
        context.arc(myArc.x, myArc.y, myArc.radius, myArc.startAngle, myArc.endAngle, myArc.counterClockwise);
        context.fillStyle = '#8ED6FF';
        context.fill();
        context.lineWidth = myArc.borderWidth;
        context.strokeStyle = 'black';
        context.stroke();
    }
    function animate(lastTime, myArc, runAnimation, canvas, context, koefX, koefY) {
        if(runAnimation.value) {
            // update
            var time = (new Date()).getTime();
            var timeDiff = time - lastTime;

            // pixels / second
            var linearSpeed = 100;
            var linearDistEachFrame = linearSpeed * timeDiff / 1000;
            var currentX = myArc.x;
            var currentY = myArc.y;

            if(currentX <= canvas.width - myArc.radius - myArc.borderWidth / 2 && currentX >= myArc.radius + myArc.borderWidth) {
                var newX = currentX + koefX * linearDistEachFrame;
                myArc.x = newX;
            }

            if(currentY <= canvas.height - myArc.radius - myArc.borderWidth / 2 && currentY >= myArc.radius + myArc.borderWidth) {
                var newY = currentY + koefY * linearDistEachFrame;
                myArc.y = newY;
            }
            // clear
            context.clearRect(0, 0, canvas.width, canvas.height);

            // draw
            drawArc(myArc, context);

            // request new frame
            requestAnimFrame(function() {
                animate(time, myArc, runAnimation, canvas, context, koefX, koefY);
            });
        }
    }
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');

    window.addEventListener('resize', resizeCanvas, false);

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        /**
         * Your drawings need to be inside this function otherwise they will be reset when
         * you resize the browser window and the canvas goes will be cleared.
         */

    }
    resizeCanvas();
    var myArc = {
        x: 50,
        y: canvas.height / 2,
        radius: 35,
        startAngle: Math.PI,
        endAngle: 4 * Math.PI,
        counterClockwise: false,
        borderWidth: 3
    };
    var runAnimation = {
        //value: false
        value: true
    };
    function processKey(e) {
        if (e.keyCode == 37) {
            // flip flag
            //runAnimation.value = !runAnimation.value;

            if(runAnimation.value) {
                var date = new Date();
                var time = date.getTime();
                animate(time, myArc, runAnimation, canvas, context, -1, 0);
            }
        }
        if (e.keyCode == 39){
            // flip flag
            //runAnimation.value = !runAnimation.value;

            if(runAnimation.value) {
                var date = new Date();
                var time = date.getTime();
                animate(time, myArc, runAnimation, canvas, context, 1, 0);
            }
        }
        if (e.keyCode == 38){
            // flip flag
            //runAnimation.value = !runAnimation.value;

            if(runAnimation.value) {
                var date = new Date();
                var time = date.getTime();
                animate(time, myArc, runAnimation, canvas, context, 0, -1);
            }
        }
        if (e.keyCode == 40){
            // flip flag
            //runAnimation.value = !runAnimation.value;

            if(runAnimation.value) {
                var date = new Date();
                var time = date.getTime();
                animate(time, myArc, runAnimation, canvas, context, 0, 1);
            }
        }
    }

    window.onkeydown = processKey;
    // add click listener to canvas
    /*
    document.getElementById('myCanvas').addEventListener('keydown', function(e) {
        if (e.keyCode == 37) {
        // flip flag
        runAnimation.value = !runAnimation.value;

        if(runAnimation.value) {
            var date = new Date();
            var time = date.getTime();
            animate(time, myArc, runAnimation, canvas, context);
        }
        }
    });
    */

    drawArc(myArc, context);

</script>
</body>
</html>